<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API Test - Ngrok Bypass</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            border-bottom: 3px solid #4CAF50;
            padding-bottom: 10px;
        }
        .test-section {
            margin: 30px 0;
            padding: 20px;
            background: #f9f9f9;
            border-left: 4px solid #4CAF50;
        }
        button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 12px 30px;
            font-size: 16px;
            border-radius: 5px;
            cursor: pointer;
            margin: 10px 10px 10px 0;
        }
        button:hover {
            background: #45a049;
        }
        button.error {
            background: #f44336;
        }
        button.error:hover {
            background: #da190b;
        }
        .result {
            margin-top: 20px;
            padding: 15px;
            background: white;
            border: 1px solid #ddd;
            border-radius: 5px;
            white-space: pre-wrap;
            font-family: monospace;
            max-height: 400px;
            overflow-y: auto;
        }
        .success {
            border-left: 4px solid #4CAF50;
            background: #e8f5e9;
        }
        .error-result {
            border-left: 4px solid #f44336;
            background: #ffebee;
        }
        .status {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 3px;
            margin-bottom: 10px;
            font-weight: bold;
        }
        .status.ok {
            background: #4CAF50;
            color: white;
        }
        .status.fail {
            background: #f44336;
            color: white;
        }
        .code-example {
            background: #263238;
            color: #aed581;
            padding: 20px;
            border-radius: 5px;
            overflow-x: auto;
            margin: 15px 0;
        }
        .info-box {
            background: #e3f2fd;
            border-left: 4px solid #2196F3;
            padding: 15px;
            margin: 20px 0;
        }
        .warning-box {
            background: #fff3e0;
            border-left: 4px solid #ff9800;
            padding: 15px;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ AI Studio API Test - Ngrok Bypass Verification</h1>
        
        <div class="info-box">
            <strong>üìå Purpose:</strong> This page tests your AI Studio API with and without the ngrok bypass header to demonstrate the correct implementation.
        </div>

        <!-- Test 1: WITHOUT Header (should work because reverse proxy adds it) -->
        <div class="test-section">
            <h2>Test 1: Fetch WITHOUT Header</h2>
            <p>This tests if the reverse proxy is adding the header automatically.</p>
            <button onclick="testWithoutHeader()">Run Test</button>
            <div id="result1" class="result" style="display:none;"></div>
        </div>

        <!-- Test 2: WITH Header (recommended approach) -->
        <div class="test-section">
            <h2>Test 2: Fetch WITH Header ‚úÖ (Recommended)</h2>
            <p>This is the <strong>recommended approach</strong> for your frontend.</p>
            <button onclick="testWithHeader()">Run Test</button>
            <div id="result2" class="result" style="display:none;"></div>
        </div>

        <!-- Test 3: Axios Example -->
        <div class="test-section">
            <h2>Test 3: Axios WITH Header</h2>
            <p>Example using Axios (if you're using it).</p>
            <button onclick="testWithAxios()">Run Test (loads axios first)</button>
            <div id="result3" class="result" style="display:none;"></div>
        </div>

        <!-- Test 4: POST Example -->
        <div class="test-section">
            <h2>Test 4: POST Request (Create Model)</h2>
            <p>Test creating a model with multipart/form-data.</p>
            <button onclick="testPostRequest()">Run Test</button>
            <div id="result4" class="result" style="display:none;"></div>
        </div>

        <!-- Code Examples -->
        <div class="test-section">
            <h2>üìù Copy-Paste Code for Your Frontend</h2>
            
            <h3>React Example:</h3>
            <div class="code-example">
// Option 1: Using fetch (recommended)
const fetchModels = async () => {
    try {
        const response = await fetch(
            'https://zestfully-chalky-nikia.ngrok-free.dev/AIStudio/api/v1/models/',
            {
                headers: {
                    'ngrok-skip-browser-warning': 'true'
                }
            }
        );
        const data = await response.json();
        console.log(data);
    } catch (error) {
        console.error('Error:', error);
    }
};

// Option 2: Using axios (set globally)
import axios from 'axios';

// Set this ONCE in your app initialization
axios.defaults.headers.common['ngrok-skip-browser-warning'] = 'true';
axios.defaults.baseURL = 'https://zestfully-chalky-nikia.ngrok-free.dev/AIStudio';

// Then use normally
const models = await axios.get('/api/v1/models/');
            </div>

            <h3>Vue Example:</h3>
            <div class="code-example">
// In your main.js or app setup
import axios from 'axios';

axios.defaults.headers.common['ngrok-skip-browser-warning'] = 'true';
axios.defaults.baseURL = 'https://zestfully-chalky-nikia.ngrok-free.dev/AIStudio';

// In your component
export default {
    data() {
        return {
            models: []
        }
    },
    async mounted() {
        try {
            const response = await axios.get('/api/v1/models/');
            this.models = response.data.models;
        } catch (error) {
            console.error('Error:', error);
        }
    }
}
            </div>

            <h3>Angular Example:</h3>
            <div class="code-example">
// In your service
import { HttpClient, HttpHeaders } from '@angular/common/http';

export class ApiService {
    private baseUrl = 'https://zestfully-chalky-nikia.ngrok-free.dev/AIStudio';
    
    constructor(private http: HttpClient) {}
    
    getModels() {
        const headers = new HttpHeaders({
            'ngrok-skip-browser-warning': 'true'
        });
        
        return this.http.get(`${this.baseUrl}/api/v1/models/`, { headers });
    }
}
            </div>

            <h3>Vanilla JavaScript:</h3>
            <div class="code-example">
// Simple fetch
fetch('https://zestfully-chalky-nikia.ngrok-free.dev/AIStudio/api/v1/models/', {
    headers: {
        'ngrok-skip-browser-warning': 'true'
    }
})
.then(response => response.json())
.then(data => console.log(data))
.catch(error => console.error('Error:', error));
            </div>
        </div>

        <div class="warning-box">
            <strong>‚ö†Ô∏è Important Notes:</strong>
            <ul>
                <li>Always add the header <code>ngrok-skip-browser-warning: true</code> to ALL API requests</li>
                <li>Set it globally in your HTTP client for easier maintenance</li>
                <li>The browser warning page is normal - users won't see it when using your app</li>
                <li>Your Hobby account IS working - this is just ngrok's anti-phishing protection</li>
            </ul>
        </div>
    </div>

    <script>
        const API_BASE = 'https://zestfully-chalky-nikia.ngrok-free.dev/AIStudio';

        // Test 1: Without header
        async function testWithoutHeader() {
            const resultDiv = document.getElementById('result1');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = '<div class="status">Testing...</div>';

            try {
                const response = await fetch(`${API_BASE}/api/v1/models/`);
                const data = await response.json();
                
                resultDiv.className = 'result success';
                resultDiv.innerHTML = `
                    <div class="status ok">‚úÖ SUCCESS</div>
                    <strong>Response:</strong>
                    ${JSON.stringify(data, null, 2)}
                `;
            } catch (error) {
                resultDiv.className = 'result error-result';
                resultDiv.innerHTML = `
                    <div class="status fail">‚ùå FAILED</div>
                    <strong>Error:</strong>
                    ${error.message}
                `;
            }
        }

        // Test 2: With header (recommended)
        async function testWithHeader() {
            const resultDiv = document.getElementById('result2');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = '<div class="status">Testing...</div>';

            try {
                const response = await fetch(`${API_BASE}/api/v1/models/`, {
                    headers: {
                        'ngrok-skip-browser-warning': 'true'
                    }
                });
                const data = await response.json();
                
                resultDiv.className = 'result success';
                resultDiv.innerHTML = `
                    <div class="status ok">‚úÖ SUCCESS - This is the recommended approach!</div>
                    <strong>Response:</strong>
                    ${JSON.stringify(data, null, 2)}
                `;
            } catch (error) {
                resultDiv.className = 'result error-result';
                resultDiv.innerHTML = `
                    <div class="status fail">‚ùå FAILED</div>
                    <strong>Error:</strong>
                    ${error.message}
                `;
            }
        }

        // Test 3: Axios example
        async function testWithAxios() {
            const resultDiv = document.getElementById('result3');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = '<div class="status">Loading axios and testing...</div>';

            try {
                // Load axios if not already loaded
                if (typeof axios === 'undefined') {
                    await new Promise((resolve, reject) => {
                        const script = document.createElement('script');
                        script.src = 'https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js';
                        script.onload = resolve;
                        script.onerror = reject;
                        document.head.appendChild(script);
                    });
                }

                // Set default header
                axios.defaults.headers.common['ngrok-skip-browser-warning'] = 'true';

                // Make request
                const response = await axios.get(`${API_BASE}/api/v1/models/`);
                
                resultDiv.className = 'result success';
                resultDiv.innerHTML = `
                    <div class="status ok">‚úÖ SUCCESS with Axios!</div>
                    <strong>Response:</strong>
                    ${JSON.stringify(response.data, null, 2)}
                `;
            } catch (error) {
                resultDiv.className = 'result error-result';
                resultDiv.innerHTML = `
                    <div class="status fail">‚ùå FAILED</div>
                    <strong>Error:</strong>
                    ${error.message}
                `;
            }
        }

        // Test 4: POST request
        async function testPostRequest() {
            const resultDiv = document.getElementById('result4');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = '<div class="status">Testing POST request...</div>';

            try {
                // Create a simple test image (1x1 red pixel PNG)
                const testImage = 'iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mP8z8DwHwAFBQIAX8jx0gAAAABJRU5ErkJggg==';
                
                // Convert base64 to blob
                const byteCharacters = atob(testImage);
                const byteNumbers = new Array(byteCharacters.length);
                for (let i = 0; i < byteCharacters.length; i++) {
                    byteNumbers[i] = byteCharacters.charCodeAt(i);
                }
                const byteArray = new Uint8Array(byteNumbers);
                const blob = new Blob([byteArray], { type: 'image/png' });

                // Create FormData
                const formData = new FormData();
                formData.append('name', 'Test Model from Frontend');
                formData.append('image', blob, 'test.png');

                const response = await fetch(`${API_BASE}/api/v1/models/`, {
                    method: 'POST',
                    headers: {
                        'ngrok-skip-browser-warning': 'true'
                        // Don't set Content-Type - browser sets it automatically with boundary
                    },
                    body: formData
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(JSON.stringify(errorData, null, 2));
                }

                const data = await response.json();
                
                resultDiv.className = 'result success';
                resultDiv.innerHTML = `
                    <div class="status ok">‚úÖ SUCCESS - Model created!</div>
                    <strong>Response:</strong>
                    ${JSON.stringify(data, null, 2)}
                    <br><br>
                    <strong>Note:</strong> A new model was created in your database!
                `;
            } catch (error) {
                resultDiv.className = 'result error-result';
                resultDiv.innerHTML = `
                    <div class="status fail">‚ùå FAILED</div>
                    <strong>Error:</strong>
                    ${error.message}
                `;
            }
        }

        // Auto-run first test on page load
        window.addEventListener('load', () => {
            console.log('‚úÖ Test page loaded. API Base URL:', API_BASE);
            console.log('üí° Click the buttons to run tests!');
        });
    </script>
</body>
</html>


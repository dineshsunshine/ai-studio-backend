# üì∏ Looks API - Complete Documentation

## üåê Public API Base URL
```
https://zestfully-chalky-nikia.ngrok-free.dev/AIStudio/api/v1/looks
```

## üìö Interactive API Documentation
- **Swagger UI**: https://zestfully-chalky-nikia.ngrok-free.dev/AIStudio/docs
- **ReDoc**: https://zestfully-chalky-nikia.ngrok-free.dev/AIStudio/redoc

---

## üìã Overview

The Looks API manages the full lifecycle of fashion "looks" - combinations of AI-generated images and the products used to create them.

**Key Features:**
- ‚úÖ Create looks with base64-encoded images (automatically saved to storage)
- ‚úÖ Separate products table with relationship to looks
- ‚úÖ Pagination support for listing looks
- ‚úÖ Update look title/notes
- ‚úÖ Cascade delete (removes images and products)
- ‚úÖ Full CORS support for web apps

---

## üóÇÔ∏è Data Models

### Product (Nested in Look)
```json
{
  "sku": "string (optional)",
  "name": "string (required)",
  "designer": "string (optional)",
  "price": "number (optional)",
  "productUrl": "string (optional)",
  "thumbnailUrl": "string (required, generated by backend)"
}
```

### Look
```json
{
  "id": "string (UUID, auto-generated)",
  "title": "string (optional)",
  "notes": "string (optional)",
  "generatedImageUrl": "string (auto-generated public URL)",
  "products": "[Product]",
  "createdAt": "string (ISO 8601)",
  "updatedAt": "string (ISO 8601)"
}
```

---

## üîå API Endpoints

### 1. Create a New Look
**`POST /api/v1/looks/`**

Creates a new look with products. Backend automatically processes base64 images and saves them to storage.

#### Request Body (JSON)
```json
{
  "title": "My Awesome Fall Look",
  "generatedImageBase64": "data:image/png;base64,iVBORw0KGgo...",
  "products": [
    {
      "sku": "217348924",
      "name": "Gaby Chain Bag",
      "designer": "Saint Laurent",
      "price": 11500,
      "productUrl": "https://www.ounass.ae/...",
      "thumbnailBase64": "data:image/jpeg;base64,/9j/4AAQSkZJRg..."
    }
  ]
}
```

#### Response (201 Created)
```json
{
  "id": "a1b2c3d4-e5f6-7890-1234-567890abcdef",
  "title": "My Awesome Fall Look",
  "notes": null,
  "generatedImageUrl": "https://zestfully-chalky-nikia.ngrok-free.dev/AIStudio/assets/looks/a1b2c3d4.png",
  "products": [
    {
      "id": "f1e2d3c4-b5a6-7890-1234-567890fedcba",
      "sku": "217348924",
      "name": "Gaby Chain Bag",
      "designer": "Saint Laurent",
      "price": 11500,
      "productUrl": "https://www.ounass.ae/...",
      "thumbnailUrl": "https://zestfully-chalky-nikia.ngrok-free.dev/AIStudio/assets/products/217348924.png",
      "createdAt": "2024-10-27T10:00:00Z"
    }
  ],
  "createdAt": "2024-10-27T10:00:00Z",
  "updatedAt": "2024-10-27T10:00:00Z"
}
```

#### Error Responses
- **400 Bad Request**: Missing required fields or invalid base64
- **500 Internal Server Error**: Storage or database error

---

### 2. List All Looks (with Pagination)
**`GET /api/v1/looks/`**

Retrieves a paginated list of all looks.

#### Query Parameters
- `skip` (optional, default: 0): Number of records to skip
- `limit` (optional, default: 100, max: 1000): Maximum records to return

#### Request Example
```bash
GET /api/v1/looks/?skip=0&limit=10
```

#### Response (200 OK)
```json
{
  "looks": [
    {
      "id": "a1b2c3d4-e5f6-7890-1234-567890abcdef",
      "title": "My Awesome Fall Look",
      "notes": null,
      "generatedImageUrl": "https://.../assets/looks/a1b2c3d4.png",
      "products": [...],
      "createdAt": "2024-10-27T10:00:00Z",
      "updatedAt": "2024-10-27T10:00:00Z"
    }
  ],
  "total": 1,
  "skip": 0,
  "limit": 10
}
```

---

### 3. Get a Single Look
**`GET /api/v1/looks/{id}/`**

Retrieves the full details of a specific look by ID.

#### Response (200 OK)
```json
{
  "id": "a1b2c3d4-e5f6-7890-1234-567890abcdef",
  "title": "My Awesome Fall Look",
  "notes": null,
  "generatedImageUrl": "https://.../assets/looks/a1b2c3d4.png",
  "products": [...],
  "createdAt": "2024-10-27T10:00:00Z",
  "updatedAt": "2024-10-27T10:00:00Z"
}
```

#### Error Responses
- **404 Not Found**: Look with specified ID doesn't exist

---

### 4. Update a Look
**`PATCH /api/v1/looks/{id}/`**

Updates a look's title or notes. Images and products cannot be modified.

#### Request Body (JSON)
```json
{
  "title": "Updated Fall Look Title",
  "notes": "Added some styling notes"
}
```

#### Response (200 OK)
```json
{
  "id": "a1b2c3d4-e5f6-7890-1234-567890abcdef",
  "title": "Updated Fall Look Title",
  "notes": "Added some styling notes",
  "generatedImageUrl": "https://.../assets/looks/a1b2c3d4.png",
  "products": [...],
  "createdAt": "2024-10-27T10:00:00Z",
  "updatedAt": "2024-10-27T10:05:00Z"
}
```

#### Error Responses
- **404 Not Found**: Look with specified ID doesn't exist
- **500 Internal Server Error**: Database error

---

### 5. Delete a Look
**`DELETE /api/v1/looks/{id}/`**

Permanently deletes a look, including:
- The look record
- All associated products (cascade)
- The generated image from storage
- All product thumbnails from storage

#### Response (204 No Content)
Empty response body with 204 status code.

#### Error Responses
- **404 Not Found**: Look with specified ID doesn't exist
- **500 Internal Server Error**: Deletion error

---

## üíª Frontend Integration Guide

### JavaScript/TypeScript Example

#### Create a Look
```javascript
async function createLook(imageBase64, products) {
  const response = await fetch(
    'https://zestfully-chalky-nikia.ngrok-free.dev/AIStudio/api/v1/looks/',
    {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({
        title: 'My New Look',
        generatedImageBase64: imageBase64,
        products: products
      })
    }
  );
  
  if (!response.ok) {
    throw new Error(`HTTP error! status: ${response.status}`);
  }
  
  const look = await response.json();
  console.log('Created look:', look.id);
  return look;
}
```

#### List Looks
```javascript
async function fetchLooks(skip = 0, limit = 10) {
  const response = await fetch(
    `https://zestfully-chalky-nikia.ngrok-free.dev/AIStudio/api/v1/looks/?skip=${skip}&limit=${limit}`
  );
  
  const data = await response.json();
  console.log(`Fetched ${data.looks.length} of ${data.total} looks`);
  return data;
}
```

#### Update a Look
```javascript
async function updateLook(lookId, updates) {
  const response = await fetch(
    `https://zestfully-chalky-nikia.ngrok-free.dev/AIStudio/api/v1/looks/${lookId}/`,
    {
      method: 'PATCH',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify(updates)
    }
  );
  
  return await response.json();
}
```

#### Delete a Look
```javascript
async function deleteLook(lookId) {
  const response = await fetch(
    `https://zestfully-chalky-nikia.ngrok-free.dev/AIStudio/api/v1/looks/${lookId}/`,
    {
      method: 'DELETE'
    }
  );
  
  if (response.status === 204) {
    console.log('Look deleted successfully');
  }
}
```

---

## üîê Security & Best Practices

### Base64 Image Handling
1. **Frontend**: Encode images as base64 before sending
2. **Backend**: Automatically decodes and saves to secure storage
3. **Response**: Returns public URLs (not base64)

### Image Storage
- **Local Development**: `/assets/looks/` and `/assets/products/`
- **Production**: Can be configured to use Google Cloud Storage or AWS S3
- **Access**: All images are publicly accessible via their URLs

### Error Handling
Always check response status codes:
- `201`: Created successfully
- `200`: OK
- `204`: Deleted successfully
- `400`: Bad request (invalid data)
- `404`: Not found
- `500`: Server error

---

## üìä Database Schema

### `looks` Table
| Column | Type | Description |
|--------|------|-------------|
| `id` | UUID | Primary key |
| `title` | String | Optional title |
| `notes` | Text | Optional notes |
| `generated_image_url` | String | URL to stored image |
| `created_at` | DateTime | Creation timestamp |
| `updated_at` | DateTime | Last update timestamp |

### `products` Table
| Column | Type | Description |
|--------|------|-------------|
| `id` | UUID | Primary key |
| `look_id` | UUID | Foreign key to `looks` |
| `sku` | String | Product SKU (optional) |
| `name` | String | Product name |
| `designer` | String | Designer/brand (optional) |
| `price` | Float | Price (optional) |
| `product_url` | String | Product page URL (optional) |
| `thumbnail_url` | String | URL to thumbnail image |
| `created_at` | DateTime | Creation timestamp |

---

## üß™ Testing

### Using cURL

#### Create a Look
```bash
curl -X POST "https://zestfully-chalky-nikia.ngrok-free.dev/AIStudio/api/v1/looks/" \
  -H "Content-Type: application/json" \
  -d '{
    "title": "Test Look",
    "generatedImageBase64": "data:image/png;base64,iVBORw0KGgo...",
    "products": [
      {
        "name": "Test Product",
        "thumbnailBase64": "data:image/png;base64,iVBORw0KGgo..."
      }
    ]
  }'
```

#### List Looks
```bash
curl "https://zestfully-chalky-nikia.ngrok-free.dev/AIStudio/api/v1/looks/?limit=5"
```

#### Get a Look
```bash
curl "https://zestfully-chalky-nikia.ngrok-free.dev/AIStudio/api/v1/looks/{id}/"
```

#### Update a Look
```bash
curl -X PATCH "https://zestfully-chalky-nikia.ngrok-free.dev/AIStudio/api/v1/looks/{id}/" \
  -H "Content-Type: application/json" \
  -d '{"title": "Updated Title"}'
```

#### Delete a Look
```bash
curl -X DELETE "https://zestfully-chalky-nikia.ngrok-free.dev/AIStudio/api/v1/looks/{id}/"
```

---

## üöÄ Quick Start Summary

1. **Create looks** with base64-encoded images ‚Üí Backend saves to storage
2. **List looks** with pagination ‚Üí Get all your saved looks
3. **Update looks** ‚Üí Modify title or notes
4. **Delete looks** ‚Üí Remove looks and cleanup all associated files

**All image URLs are public and ready to use in your frontend!** üé®

---

## üìû Support

For issues or questions:
- Check the interactive docs: https://zestfully-chalky-nikia.ngrok-free.dev/AIStudio/docs
- Review error responses for debugging
- Ensure base64 images are properly formatted


